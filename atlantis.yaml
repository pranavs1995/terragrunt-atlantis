version: 3
projects:
- dir: dev/eu-west-1
  workspace: dev
  workflow: terragrunt
# - dir: deploy/eu-west-2
#   workspace: dev
#   workflow: terragrunt

workflows:
  terragrunt:
    plan:
      steps:
      - env:
          name: TERRAGRUNT_TFPATH
          command: 'echo "/usr/local/bin/terraform"'
      - run: terragrunt plan -out $PLANFILE
    apply:
      steps:
      - env:
          name: TERRAGRUNT_TFPATH
          command: 'echo "/usr/local/bin/terraform"'
      - run: terragrunt apply $PLANFILE
